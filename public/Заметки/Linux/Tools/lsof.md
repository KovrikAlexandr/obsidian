List open files – выводит информацию о всех открытых файлах. В Linux все есть файл. Например:


Вывод базовой команды:
```bash
$ lsof
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
```

##### COMMAND
Имя процесса. Присваивается при запуске, но может меняться (например, у демонов).
Утилита может брать значение из следующих источников:
- `/proc/<PID>/comm`
- `/proc/<PID>/stat`
- `/proc/<PID>/exec`

Обычно назначается как название бинарника, либо интерпретатора
- `/usr/bin/nginx` –> имя будет просто `nginx`
- `python3 main.py` –> имя будет просто `python3`

---
##### PID
Идентификатор процесса.

Подробнее про процессы в [Процессы](obsidian://open?vault=Vault&file=%D0%97%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8%2FLinux%2F%D0%9F%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D1%8B)

---
##### USER
Пользователь, запустивший процесс

---
##### FD
File Descriptor – файловый дескриптор

Суффиксы:
- `r` — read
- `w` — write
- `u` — read/write

Значения:
- `0r` – stdin для чтения (read)
- `1w` – stdout для записи (write)
- `2w` – stderr для записи (write)
- `3u` – 3 дескриптор для чтения и записи (`u` значит read/write)
- `4r`, `5w` – 4 для чтения, 5 для записи

Расширенные варианты (обычно метка назначения объекта):
- `cwd` – current working directory
- `txt` – файл является бинарём, из которого был запущен процесс. Пример:
	```bash
	sshd 962 root txt REG 253,0 399952 1139230 /usr/sbin/sshd
	```

- `mem` – чаще всего – файл, который процесс подключил как memory-mapped (mmap). Например, shared libraries – `*.so`. 

- `DEL` – файл удалён, но процесс все ещё держит его открытым. Inode в таком случае остаётся жить, пока процесс не закроет файл.
---
##### TYPE
Тип объекта.

Значения:
- `REG` – обычный файл
- `DIR` – директория
- `CHR` – символьное устройство
- `BLK` – блочное устройство
- `FIFO` – очередь (pipe)
- `SOCK` – сокет

---
##### DEVICE
Устройство, на котором лежит файл. Выводится как два числа в формате `major,minor`, где:
- `major` – Номер драйвера
- `minor` – Экземпляр устройства внутри этого драйвера

Подробнее распишу в [Устройства (Devices)](obsidian://open?vault=Vault&file=%D0%97%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8%2FLinux%2F%D0%A3%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0%20(Devices))

---
##### SIZE/OFF
- Размер файла
- Смещение (offset) файла

---
##### NODE
- Номер inode
- Для сокетов – внутренний ID
- UDP/TCP

---
##### NAME
Имя файла, сокета или ресурса:
- Путь к файлу
- `localhost:8080`
- pipe

### Полезные флаги

По процессу:
- `-p PID` — по PID
- `-R` – добавит Parent PID (PPID)
- `-c name` — по имени процесса
- `-u user` — по пользователю
- `-u ^user` – всех пользователей кроме `user`

---

По файлу:
- `lsof /path/to/file` – путь к файлу
- `lsof -d <FD>` – по файловому дискриптору
- `lsof +D /path/to/dir` – все файлы в директории (рекурсивно)

## Работа с сетью

Утилита позволяет отслеживать связь `процесс <–> сетевой сокет`.

Просмотреть все сетевые сокеты:
```bash
lsof -i
```
- `-n` – чтобы отображать численный IP адрес
- `-P` – чтобы видеть порт, а не имя службы

Уточнить TCP или UDP:
```bash
lsof -i TCP # Аналогично для UDP
```

Протокол и порт:
```bash
lsof -i TCP:22
```

Состояние (`LISTEN/ESTABLISHED`):
```bash
sudo lsof -i -s TCP:LISTEN
```

Пример использования – посмотреть открытые ssh соединения:
```bash
sudo lsof -a -i TCP -s TCP:ESTABLISHED -c sshd -n -P 2> /dev/null
```
- `-i TCP` – все сетевые сокеты на протоколе TCP
- `-s TCP:ESTABLISHED` – только установленные соединения
- `-c sshd` – COMMAND начинается с sshd (работает как sshd\*)
- `-n -P` – порты и IP адреса только цифрами
- `-a` – And. Используется для объединения нескольких условий (`i` и `c` в данном случае)
